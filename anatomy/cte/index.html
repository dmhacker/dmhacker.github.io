<html>

<head>
    <title>Chronic Traumatic Encephalopathy</title>
    <link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <script src="/static/js/three.js"></script>
    <script src="http://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="http://threejs.org/examples/js/loaders/STLLoader.js"></script>
    <!--- script src="http://threejs.org/examples/js/modifiers/SubdivisionModifier.js"></script --->
    <script>
        javascript: (function () {
            var script = document.createElement('script');
            script.onload = function () {
                var stats = new Stats();
                document.body.appendChild(stats.dom);
                requestAnimationFrame(function loop() {
                    stats.update();
                    requestAnimationFrame(loop)
                });
            };
            script.src = '//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';
            document.head.appendChild(script);
        })()
    </script>
    <script>
        var supportsWebGL = function () {
            try {
                return !!window.WebGLRenderingContext && !!document.createElement('canvas').getContext('experimental-webgl');
            } catch (e) {
                return false;
            }
        };

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

        var renderer = supportsWebGL ? new THREE.WebGLRenderer({
            antialias: true
        }) : new THREE.CanvasRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000);

        document.body.appendChild(renderer.domElement);

        init();

        function init() {
            var controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.position = new THREE.Vector3(0, 0, 0);

            var ambLight = new THREE.AmbientLight(0x333333);
            scene.add(ambLight);

            var light = new THREE.DirectionalLight(0xffffff);
            light.position.set(0, 0, 1).normalize();
            scene.add(light);

            var loader = new THREE.STLLoader();
            loader.load('brain.stl', function (geometry) {
                loader.load('cte.stl', function (cteGeometry) {
                    /*
                    var modifier = new THREE.SubdivisionModifier(3);
                    geometry.computeFaceNormals();
                    geometry.computeVertexNormals();
                    modifier.supportUVs = false;
                    modifier.modify(geometry);
                    */

                    var material = new THREE.MeshPhongMaterial({
                        color: 0xffdead,
                        specular: 0x555555,
                        shininess: 15,
                        shading: THREE.SmoothShading
                    });

                    var healthyBrain = new THREE.Mesh(geometry, material);
                    scene.add(healthyBrain);

                    healthyBrain.position.x = 0;
                    healthyBrain.position.y = 0;
                    healthyBrain.position.z = 0;
                    healthyBrain.rotation.y -= 0.5; // Angle the brain slightly downwards
                    healthyBrain.scale.set(1, 1, 1);

                    var box = new THREE.Box3().setFromObject(healthyBrain);
                    box.center(healthyBrain.position);
                    healthyBrain.position.multiplyScalar(-1);

                    var pivot = new THREE.Group();
                    scene.add(pivot);
                    pivot.add(healthyBrain);
                    pivot.position.x -= 50;

                    var cteMaterial = new THREE.MeshPhongMaterial({
                        color: 0xcd853f,
                        specular: 0x555555,
                        shininess: 5,
                        shading: THREE.SmoothShading
                    });
                    var cteBrain = new THREE.Mesh(cteGeometry, cteMaterial);
                    scene.add(cteBrain);

                    cteBrain.position.x = 0;
                    cteBrain.position.y = 0;
                    cteBrain.position.z = 0;
                    cteBrain.scale.set(0.75, 0.75, 0.75);

                    var box2 = new THREE.Box3().setFromObject(cteBrain);
                    box2.center(cteBrain.position);
                    cteBrain.position.multiplyScalar(-1);

                    var pivot2 = new THREE.Group();
                    scene.add(pivot2);
                    pivot2.add(cteBrain);
                    pivot2.position.x += 50;

                    pivot.rotation.x += Math.PI * 3 / 2;
                    pivot2.rotation.x += Math.PI * 3 / 2;
                    pivot.rotation.z += Math.PI / 2;
                    pivot2.rotation.z += Math.PI;

                    camera.position.x = 0;
                    camera.position.y = 0;
                    camera.position.z = 100;

                    requestAnimationFrame(animate);

                    function animate() {

                        pivot.rotation.z += 0.007;
                        pivot2.rotation.z -= 0.007;

                        controls.update();

                        renderer.render(scene, camera);

                        requestAnimationFrame(animate);
                    }

                    animate();
                });
            });

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>

</html>
