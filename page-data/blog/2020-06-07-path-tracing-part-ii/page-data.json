{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2020-06-07-path-tracing-part-ii/","result":{"data":{"markdownRemark":{"id":"668790b6-e876-5608-9acf-a76ccc108589","excerpt":"For starters, please first read my previous post, part 1, which\ndescribes some of the context regarding the construction of\nmy path tracer. I left off last time…","html":"<p>For starters, please first read my previous post, <a href=\"/blog/2020-05-26-path-tracing-part-i/\">part 1</a>, which\ndescribes some of the context regarding the construction of\nmy path tracer. I left off last time with an incomplete\nglass renderer, so this is where the blog post picks up from.</p>\n<h4>Rendering Glass</h4>\n<p>I began by trying to implement a glass BTDF based off of\nmicrofacet theory, as specified in my previous post. This led\nto the failing render:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84cb662b0de03034b3a7793d86648ed8/d9199/render0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfklEQVQozy3IaU/aYAAA4LcXKLSl2JZDNg6BChGQQxgItlChHGHKoYhDVGRMFuTwDposnhvOLTMuLvPTEn/psmTPxwcAAAAEAQA4k6bR3jobfboZXe7U6yiGAQBUKtIwqUdgiJmgHJwdQVAU/ff/YQgkQ2EEAtZJqtWsXd9dfhtdZxcTzmk7AMA368qlJRSBSRJfzufSSdFmMiAQkGOwDIXAhBJhcJQahzgd0dvZeH74/nh363dOuTiz2aBbXEhJUhFGIBWuKCxXMvmmwx2dUGKsEqGVCJAhAEMADAEtge2uF5/uv9xfnM/PGO2sPBu1pA55PhdUyCBKSSaqsZkDK3dg5gIKTi2za2TAQmN6EsPlsHoM2lySft7dfj4/ljx63jxW5DX8DyqZw1QK6BXL1lthex+dPoIj/BhvVEatCiBySsmBp514khvfFL0XHzeH26VyQCvZFG/8VPiKEGNyYhwOOUzHXcHUxi17soyAr7rJgpcEeRde9JArXvJdgNwVnafVzLAqtUVzw0culSjxBl8MYgwp52ct/Xqs3GRKW8ptUd2KqHfCFCj7iEqAWJvDayGyLTlOa9J5LT2QnJ2wvihoUwVVyo37DIQwpalE3cPq5HGZ3k+xXYHdE2hQD7CtOUM3ZBvO+0fx1K/M2p/V9y9vt1+SWwczop/SvyYIE0VyDBm3Mftl/aCs7SeZfpztxTWg43H9jlSfY+tPwZXHWOkhXviayF/F+LOIdyg6B0nDRoiuBunGguYwaztanurndN0E3RHoDs+AilXTME63fKbmnLG1YGunvf3CfDfn+SDodyWmt0QfJuhBQnciGU+y9r5k7SUNHUHT4dlOXPsXQU2MZKsq9L4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Failing Glass\"\n        title=\"Failing Glass\"\n        src=\"/static/84cb662b0de03034b3a7793d86648ed8/fcda8/render0.png\"\n        srcset=\"/static/84cb662b0de03034b3a7793d86648ed8/12f09/render0.png 148w,\n/static/84cb662b0de03034b3a7793d86648ed8/e4a3f/render0.png 295w,\n/static/84cb662b0de03034b3a7793d86648ed8/fcda8/render0.png 590w,\n/static/84cb662b0de03034b3a7793d86648ed8/efc66/render0.png 885w,\n/static/84cb662b0de03034b3a7793d86648ed8/d9199/render0.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After about a day and a half of tweaking variables to try to get it\nto work, I figured I would have to take a different approach.\nFrom what I could tell, the formulas for the PDF and evaluation functions\nI was implementing seemed correct, and the refractive directions I was\nsampling appeared to behave correctly depending on the mediums they\nwere entering/exiting, so I wasn’t sure exactly what was going on.\nI decided to try a different approach.</p>\n<p>Using Bram de Greve’s <a href=\"https://graphics.stanford.edu/courses/cs148-10-summer/docs/2006--degreve--reflection_refraction.pdf\">paper on refractive ray tracing</a>,\nI tried to use a simpler approach. My teaching assistant, Andrew Bauer,\nsuggested that I assume that the surface was ideally dielectric and\nwork from there. This meant that I would:</p>\n<ul>\n<li>Assume that any refracted rays were ideally coming from a single,</li>\n</ul>\n<p>perfectly refractive direction. Imperfect glass (e.g. glass with roughness)\nperturbs the refracted rays slightly, but that was not my focus.</p>\n<ul>\n<li>If a refracted ray originates from a single direction, then this would</li>\n</ul>\n<p>imply that my sampling procedure returns that ray with probability 1 and\nother rays with probability 0. I choose then to ignore my PDF by setting\nit to 1 and then cancel out the BTDF cosine term using my evaluation function.</p>\n<p>Despite this, I still needed to handle an important phenomenon when it\ncomes to rendering refractive materials: total internal reflection (TIR).\nThe basic idea behind total internal reflection is that if an incoming\nray hits a material at a sufficiently grazing angle, the resulting outgoing ray\nwill not actually be refractive, but rather, will be parallel to the surface\nand thus reflective. The angle at which this phenomenon occurs is known\nas <strong>the critical angle</strong> and is a property of the indices of refraction\nfor both the incoming and outgoing mediums. For more information, please\nsee the above paper or <a href=\"https://en.wikipedia.org/wiki/Total_internal_reflection\">the Wikipedia entry on TIR</a>.</p>\n<p>Fortunately, this phenomenon can be modeled fairly compactly in a path\ntracer by making use the <a href=\"https://en.wikipedia.org/wiki/Fresnel_equations#Complex_amplitude_reflection_and_transmission_coefficients\">Fresnel coefficient</a>,\nwhich in turn, can be generated using <a href=\"https://en.wikipedia.org/wiki/Schlick%27s_approximation\">Schlick’s approximation</a>.\nThe Fresnel coefficient essentially yields a number between 0 and 1\nthat lets us select between reflection and refraction. A high Fresnel\ncoefficient indicates a high amount of reflection; conversely, a low\nFresnel coefficient indices a high amount of refraction. A Fresnel\ncoefficient of 1 indicates total internal reflection (e.g. there is no\nrefraction, only reflection). In path tracing, we can importance sample\nthe Fresnel coefficient to select between a refractive and reflective incident ray.\nThe algorithm works as follows:</p>\n<ol>\n<li>Keep track of incoming and outgoing indices of refraction. We can do</li>\n</ol>\n<p>this by keeping track of the mediums the rays are in.\n2. Calculate the dot product of the surface normal and the outgoing ray.\n3. Use the cosine value and the IORs to calculate the Fresnel coefficient.\n4. Importance sample the Fresnel coefficient to select between reflection\nand refraction.</p>\n<p>In my case, I only had to keep track of two indices of refraction, the\nfirst being that of glass and the second being that of air. I choose to\nuse 1.51 for Flint glass and 1.003 for air. In my previous attempts, I\nextended my payload to keep track of the order in which these indices\nappear, as it is important in determining the correct refractive ray.</p>\n<p>I also swapped out my glass cup for a glass sphere, since it is\neasier to render and debug. The inside of the sphere is not hollow,\nbut rather is assumed to be entirely filled with glass.</p>\n<p>By rendering the intensity of the Fresnel coefficient as a shade\nof red on top of the diffuse version of the sphere, I got the\nfollowing image. Note that I only accounted for Fresnel coefficients\nfor rays originating from the camera:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a6b3955b5377b62f51775dcf881f4560/d9199/render1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfElEQVQozz3K609SYRzA8d9znsNBOA+JcA6o3EFupaJgCsgB5O4FFcRwKsIQBeSmTp3pVmq50Lacmza3XlSvavVPtnrR9+VnXwAAQAgALHq+UC0cdc+vum/yK1k5TZswjnk8brMZ/3swTTMMgygK/ifCiKH/grlfXt5ev7i5uO1epaZeOhAyY2yRSJyEDGEsFVGxcCAVjZi0AxiAoSkRRqBgsZLQcgmyqkmnvPnl/tN9913MYtIBGChkANACciCwa9SJxcpsumR/MdknpXiWVrIYaIRoBAiAJ6LqWubx44fby/MZ06AewICQESE9ICcNKT83fmhxNnTW5oBtXGzrY6wqBowKkVpGE4Z6xkBhMf5wc319djz7XDUsxgYAPYAOIKASz/vp0T2wVLG9RfkC4qBB6rdIIGqTJpxs0sFGrD1bEddFvXBWzOTcqqiBjJCeMaV83txbcD/LCD32XZG+JDZui5KCdHVEtuySwcIwmxkluTGy7pFVI87TtdTrtWQ9bCx6ScbF5lxsTSA1gW0m2GyZXSqSzCYpzfTu+ORlXy+sjLOv3CTvIRuTpJZwnG4kzjeS+3HnQVD7Nj50k564i0w/BoT3SdtJjjtZ5Y5z3EFc2QpxzZACCh5+Z0LTmho687u74cTnVP5rrvJ9ofgzVvod2f6Vrv+YK30Tsnde4Whe386pO1l1J8p1Qlw7zEPDNfw0lX/y5R88mXvv8l1g8VaYu/QLp97RQ69l369tTvPVgLwd7T9Mm/bThs5cf2tG0QgpG0EOVs38lsZacekqE/pKwFpLjrWXvM25kd3QYDWorAf7GoKiFVK3I9pO0txOmFoxzV5ItSfwjbD6D0bzi4Y4snMqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fresnel Coefficient\"\n        title=\"Fresnel Coefficient\"\n        src=\"/static/a6b3955b5377b62f51775dcf881f4560/fcda8/render1.png\"\n        srcset=\"/static/a6b3955b5377b62f51775dcf881f4560/12f09/render1.png 148w,\n/static/a6b3955b5377b62f51775dcf881f4560/e4a3f/render1.png 295w,\n/static/a6b3955b5377b62f51775dcf881f4560/fcda8/render1.png 590w,\n/static/a6b3955b5377b62f51775dcf881f4560/efc66/render1.png 885w,\n/static/a6b3955b5377b62f51775dcf881f4560/d9199/render1.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As we can see, the Fresnel coefficient is extremely high around the\nedges of the sphere but is very low near the center of the sphere,\nwhere the rays hit perpindicular to the surface and are simply\nrefracted through.</p>\n<p>The next step is to implement the generation of the refractive\nray. This can be done using the refraction formula listed in the\nabove paper. With a few tweaks, I ended up with the following image:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe35d92d43f587cd88b9a209c1861a49/d9199/render2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQozz3K7U8ScQDA8d89gtydItxxIIgggmchPmB4IAfIw4EkGATCVBSRBOQ40JnT2NKsBunKuZxzvale1eqfbK2t78vPvgAAACAIAGAzM6Va6bjXvey/Xs9mSSXmttL5leUZzvbvQVAUx3EIhsH/MATC0b9g1asrexsXHy6u+5fRJU/EMdBJeeSUf33WwLGkAoVjIX8iEraaDAgAOApjCAQ0BKIlUfUAZGfJdmXry+2n295b3jnBm7Hni7pdr1PkWBuNmIz6RLq6kipPPvYMq2CGQLUEAlAIQiEAA8CQWK2Yub/ufXzTfWQdwWBADqKcw2LQM0oECF6t+2iCa47aJYNjTuEYxu06HFg0GEuhJA4P4qCUjn3uv+91j4McYxhEdATCUqiOwjkWT3pRVxPYashkC/b6FYExlc82ACIOlThFxDkibFduh13njdLZTibv1nnMKh2lGNOqfFaiOEdlBeXkPmYuKyx7WFxQ5aepZzMUWHUSGReZmyU33FQtPHVaTJwV4/WQpcyT6WlV2knUBKoRICSRyFaItR0ys0WWl4f2veqKdwjk5oj1ebLgJjc9ZF3kTjfF7qbYiXGHAdN5zH6VfnITWbrzC+/ijpMcfZJnXubow5i2FaSlgAaU3MyLBWNrceKVb74fEu8Tha+56vfVnZ/R8u/w3q9U40dy95uQveGF46dmOce2s2w7QreDtBxiQNPlfOALD97CnTtzy6/d+NNXQvLSJ5zyriPe1vGZpCWm7lfLUf1RytpJjbWTemlZIwW1UoAG+XFm22ivzoxWF8xVwV6Pz8prvJSc3g+O1ALaRmC4KWhaQVYOm9rxcVm0tqLGg6DuQGCaIfYP6eiPx/nb3eoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Glass Sphere\"\n        title=\"Glass Sphere\"\n        src=\"/static/fe35d92d43f587cd88b9a209c1861a49/fcda8/render2.png\"\n        srcset=\"/static/fe35d92d43f587cd88b9a209c1861a49/12f09/render2.png 148w,\n/static/fe35d92d43f587cd88b9a209c1861a49/e4a3f/render2.png 295w,\n/static/fe35d92d43f587cd88b9a209c1861a49/fcda8/render2.png 590w,\n/static/fe35d92d43f587cd88b9a209c1861a49/efc66/render2.png 885w,\n/static/fe35d92d43f587cd88b9a209c1861a49/d9199/render2.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Looks pretty good! You can see how the sphere acts as a lens,\neffectively inverting the rays passing through it. This is why\nthe image appears upside down; this actually models real-world\nphysical phenomena. See <a href=\"https://www.quora.com/Why-crystal-clear-glass-spheres-turnn-the-image-upside-down\">this discussion</a> for more details.</p>\n<p>The final step is to bring back the more complex glass cup\nto replace the sphere.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7561eda29ede0f6110a609032b9b2b24/d9199/render3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfUlEQVQozz3IaU/aYAAA4LelLdAWwdICFqEctsBAAWsQkJZDLq9BUQYegEEUJ4fMLTNiMmeWxSNbNrMj7suSJfuhy7Jkz8cHAAAABAEA3HZmr9t4eXN5ffOmvln5l5SRshj1tA4T3Byu1SAoCsEw+A9VQRjyN5wWQ/tg5+ru6v7mOpOIcTYWBoDjpjUaDQxBHt4d8PuKuaxjekoFAIbAqAoCFKEykohBC/Fmctje+/H548Ptu6Bg97isLjvrF1yMgaQItbiQDoaklY19jz8yicMMgRgJFUAgCIEADABDokd15duHm/ury6iX5RmsuORKiH4HQ/hYTVDh7MqUr2vjB1NCWC1MYrwJAw4KNesQEoMnMNB4mvty9/79+FUuwMhOrBQzlzOByAwVd2IhBbaX4ZkW7BnCsYRa5vC4WwuWBTzvJQpeIsNrmpng2+eNi5ZSmTdlBU3ETclBLu2n1/z4bAnj1tTObTXXQQsSXp3VlYM6sB4glDlyM0TuiLpuxndeL17UC8cpx/4iqYTpnN9UntO1o/pShZCLeGmbVJrkflp/GDO0Y3qwFSaeiWRNJHcj5HHee76bH+/mR3lfP24phVnZOym5JhJOnbKkr0r6M4V+XaVHWeMgSfdlCjRE5nDBOlicGcfnb9P578Xaz62DX+ut35lWzyvbtBM4olZDKImjYYEYVSyjTfNw2XiapIcpBvSDgcfF2mOs9lVUHqKlT4mNe2n1Oi5dROfGiSencW5HNNRFqrlk6WXZFxvccNUySFP9pLEv06DqZppWvhO0dRbsHYk/LoSGpWh/ZfYoyXZT5l6aHcrUKGM5y3Ony7ZBzjHIWk+SphOJ6aXMfwA1H4WhNULBjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Glass Cup\"\n        title=\"Glass Cup\"\n        src=\"/static/7561eda29ede0f6110a609032b9b2b24/fcda8/render3.png\"\n        srcset=\"/static/7561eda29ede0f6110a609032b9b2b24/12f09/render3.png 148w,\n/static/7561eda29ede0f6110a609032b9b2b24/e4a3f/render3.png 295w,\n/static/7561eda29ede0f6110a609032b9b2b24/fcda8/render3.png 590w,\n/static/7561eda29ede0f6110a609032b9b2b24/efc66/render3.png 885w,\n/static/7561eda29ede0f6110a609032b9b2b24/d9199/render3.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Ultimately, I was very satisfied with the glass rendering that I\nproduced. I decided to leave it as an ideal dielectric surface\nand not tweak it any further using the GGX BTDF, since additional\nattempts to incorporate the BTDF ended in failure. Unfortunately,\nit took me around three days to finally get this to work, which\nate into the time I had allotted for rendering participating\nmedia using volumetric path tracing.</p>\n<p>You’ll also notice that the area covered by the glass seems\nshadowed, and that is in part because next event estimation does\nnot work through glass (direct light through glass does not\naccount for refracted rays; it’s treated as if it is a solid\nobject during the estimation).</p>\n<h4>Rendering Participating Media</h4>\n<p>For the final step of my project, I choose to render some form\nof a homogeneous participating medium that will surround most of\nthe scene. Unfortunately, due to the unforeseen amount of time that the\nglass implementation took, I was unable to complete it in a visually\nappealing manner. However, I will still document the implementation\ndetails, even though it did not contribute to my final render. The\nfollowing resources were helpful in my implementation: the\n<a href=\"https://github.com/seifeddinedridi/smallvpt\">smallvpt</a> renderer, a modification\nof the smallpt renderer to support volumetric path tracing, as well\nas <a href=\"https://computergraphics.stackexchange.com/questions/227/how-are-volumetric-effects-handled-in-raytracing\">this Stack Exchange post</a> on volumetric path tracing.</p>\n<p>In order to implement a partipicating medium, you need to use\nvolumetric path tracing. Volumetric path tracing extends the\nrendering equation with additional terms that describe how a\nray moves through a semi-transculent container of particles.\nFor this project, I assumed that the particles were homogeneous,\nin that they were evenly dispersed through the volume.</p>\n<p>Whenever a light ray passes through this volume, there are 3 situations\nthat can occur:</p>\n<ul>\n<li>Nothing happens, the ray passes through as normal.</li>\n<li>The ray hits one of the particles and is absorbed.</li>\n<li>The ray hits one of the particles and is scattered.</li>\n</ul>\n<p>These frequency of these events occurring are given by two probabilities:\nthe scattering probability and the absorption probability. The\nscattering probability is a function of both the distance the ray\nmust travel through in the medium and a constant dependent on the\nmedium, known as <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><msub><mi>a</mi><mi>s</mi></msub></mrow><annotation encoding=\"application/x-tex\">sigma_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>. Likewise, the absorption probability\nis a function of the distance the ray must travel and a constant that\nacts as a property of the medium (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><msub><mi>a</mi><mi>a</mi></msub></mrow><annotation encoding=\"application/x-tex\">sigma_a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>). Both of these probabilities\nare given as exponential functions that converge to 1 with respect to\ndistance; that is, as the ray travels through the medium, a longer\ndistance implies a smaller chance that the ray will make it through\nunscathed (not reflected or absorbed).</p>\n<p>In the case where the ray is absorbed, the ray can simply be stopped\nand contribute a reduced amount of radiance.</p>\n<p>In the case where the ray is scattered, a new direction and origin has\nto be computed for the incident, scattered ray. The origin of this\nray is usually given by picking a random “scatter point” that lies in\nbetween the first surface that the original ray intersects with and\nthe original origin. The direction of the new ray is a bit more complicated.\nThis is where phase functions come into play, which describe how rays\nare scattered in the participating medium. I choose to use the\n<a href=\"http://www.astro.umd.edu/~jph/HG_note.pdf\">Henyey-Greenstein phase function</a> to describe my medium.</p>\n<p>Using this algorithm, I was able to produce the following image:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9bc84dad5b47610bc1ac67e79df9efc5/d9199/render4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDklEQVQozz2L2U7bQBRAJzxWSIlUYt873mJ7vHs2O17ihEBwnBAQEhIqtGr//zuqUrVH5+3oEPKPEL/2Mtu26q6vcuaT2YwQsrj+onwUK7OKHGNxTWZXV1ez/wtxb+buzcK9meeO0Ytk3+n7VuvYT1zqLheJY5auUThLEVjct0S0imzDW85Xy4W3nBO5Au3jp3TgybhpDm3Vpn6brJrIqZgjA6oC1FFYxawtyjphFbNqhlWIRHim9ED9ncto7OtDo9rYqwLaJ3bNbBVgFaDmjpS2blzdOjpDHYAOgagV6M9cBXTIw7HTh1p0sdsya0itPrXXIdaBWXFDSaNqjLoz1zk0DNYMSO1DE2Ib0i60tql3UOm9iIbY3jDaMNpEVsuwY1BzU3OzrrFusctxE0MfA+kYbBgOjO4iuk/dBx6OPDxkzl1KtzHtIxwiuI1h4NCWsKvwtsZ9gfsMb1MkGwbbGHYJ7BM85M4kgkmGU+EdM2eIacugY9CF5jaDXQaTpCdFjyWOOT4USPYxfUicKfWec/ZaZN+E/LFuflbNL7l+TrPGR+kZ0jOUb3YxnBU9azxxmAqYCiSn2P/I9fdSf+Tqnat3Lt8Efy2TlyJ4KVeXwhpzGHM8FvQs8KKsR4lnDqfyj2Qf4Bh4x8Q+pvSY02NJJ25PJU6lceLmI4dLaT4JfJL0IuhFWBdBz6V55njm+BsskWgqkxKUgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Homogeneous Participating Medium\"\n        title=\"Homogeneous Participating Medium\"\n        src=\"/static/9bc84dad5b47610bc1ac67e79df9efc5/fcda8/render4.png\"\n        srcset=\"/static/9bc84dad5b47610bc1ac67e79df9efc5/12f09/render4.png 148w,\n/static/9bc84dad5b47610bc1ac67e79df9efc5/e4a3f/render4.png 295w,\n/static/9bc84dad5b47610bc1ac67e79df9efc5/fcda8/render4.png 590w,\n/static/9bc84dad5b47610bc1ac67e79df9efc5/efc66/render4.png 885w,\n/static/9bc84dad5b47610bc1ac67e79df9efc5/d9199/render4.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As you can see, the scattering of the rays is producing noticeable\ndarkening, as well as visible blurring that complements the\ndepth-of-field effect. This is an intended effect, as fog/smoke\noften results in the same. However, the image was too noisy and\neven with tweaking, still did not capture the realistic fog\neffect I was intending to recreate, and without enough time to\nmodify it any further, I decided to drop the effect from my final\nimage. Despite this, I would still like to potentially work on this\nas an improvement to my image in the future.</p>\n<h4>Final Remarks</h4>\n<p>Given that the participating media render didn’t look as\nrealistic as I would have liked it to look, I ultimately decided\nto drop the fog/smoke effect from the final render. Here is the\nfinal scene rendered, with depth-of-field added back in and\nwith 1024 samples per pixel (instead of the usual 64):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7dfdd5c12020209c57f5dcaf0827c588/d9199/render5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQozz3BaVMSYQAA4HdZYFl2WY5lOQ2Wa3EFZDk8uHa5BPGKUzQ8EEQxucxxjKxpLCvMccbJaqovTTP90L71PAAAACAIAMDQ+lZ3/9Xkzc3tdXtvVyyRAABIkjRRKp0CmXE7cRyTIogIFoP/JDAkFYtgCDhNmk67cXN7fT95X8ikWLdLBICdtqCoDIYgz4zb7/Os5nMOqwmGACIRScUQ0GAwiYtVKMQYiGFr99fD/ePthyBr8zK0wzrlm3bqNQoNLgvPZThOKGy0p31xDSahMJjEYIDAQCqCYAgYCOnxdvnb3ae769dRj8VFIWtxV2LOS1MYa5YHqk5r7Ymnb3Of00xIzqilLp0U2EmJiRATMhGJivY28o+Tm49XF7lZI29DKjFjJetbcGmjNiRYgy01mOnC7gs4wst4CxZzyEGawXIsnmfxLCPfT3NvT/bGzXIlZMi50YhTm+TojI9a9WBcWWbdQO0t1NaXLQt4zUcUOQKsefHSLFHliO0QcZxmX24VxlvL3ZStuaAoB/V5r77kV7YXVcUKzhew4o6icqBoplWdiLq1qAKVAL4ZVNTDeGOe6ObYy0b+qrE8ys30YoanoSmB1fIOJe8gKnHVZkJ5XqIua9RoieoLVE8gwW6I6oTN/XnnOBqcpJa+F+q/Nw//rDf/ZptDj2DH1UoExWBEpUDmpvHzqvGsahhmtcMkNUjqQM/v/RGt/4xvf52vfImXHpLFz8m1d3FhHOGuEt5RzLoTVj8LaZpxUy879WKdHqwYeymyJ5A9XgvqDt2BxX0YsLbD1k7CdZIPDIrR3or/SDAeCfrTlHnAk6O08SxHDzPW/hLdz5ifC/pTXnea1P8DXB6I9bUVJTIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Final Render\"\n        title=\"Final Render\"\n        src=\"/static/7dfdd5c12020209c57f5dcaf0827c588/fcda8/render5.png\"\n        srcset=\"/static/7dfdd5c12020209c57f5dcaf0827c588/12f09/render5.png 148w,\n/static/7dfdd5c12020209c57f5dcaf0827c588/e4a3f/render5.png 295w,\n/static/7dfdd5c12020209c57f5dcaf0827c588/fcda8/render5.png 590w,\n/static/7dfdd5c12020209c57f5dcaf0827c588/efc66/render5.png 885w,\n/static/7dfdd5c12020209c57f5dcaf0827c588/d9199/render5.png 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Ultimately, this was a very enjoyable project and, in my opinion,\nwas a successful end to a very enjoyable class. I hope to work\nmore with rendering in the future, perhaps continuing with\na real-time path tracer outside of the CSE 168 class.</p>","frontmatter":{"title":"Realistic Path Tracing (part II)","date":"June 07, 2020","description":"Rendering glass and wrapping up my path tracer"}}},"pageContext":{"slug":"/blog/2020-06-07-path-tracing-part-ii/","previous":{"fields":{"slug":"/blog/2020-05-26-path-tracing-part-i/"},"frontmatter":{"title":"Realistic Path Tracing (part I)"}},"next":null}},"staticQueryHashes":["3000541721"]}